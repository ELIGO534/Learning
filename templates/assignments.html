{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Assignments - EliGo</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/favicon_io/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'assets/img/favicon_io/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'assets/img/favicon_io/favicon-16x16.png' %}">
  <link rel="manifest" href="{% static 'assets/img/favicon_io/site.webmanifest' %}">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/aos/aos.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="{% static 'assets/css/main.css' %}" rel="stylesheet">

  <!-- Chat Page Specific CSS -->
  <style>
    /* Chat Page Specific Styles - Scoped to avoid conflicts */
    .chat-page {
      --primary-color: #3498db;
      --secondary-color: #2c3e50;
      --success-color: #27ae60;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --light-bg: #f8f9fa;
      --dark-text: #333;
      --light-text: #777;
    }
    
    .chat-page .task-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .chat-page .task-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
    
    .chat-page .task-header {
      padding: 25px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--light-bg);
      border-bottom: 1px solid #eee;
    }
    
    .chat-page .task-header:hover {
      background-color: #f1f1f1;
    }
    
    .chat-page .task-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--secondary-color);
      margin: 0 0 5px 0;
    }
    
    .chat-page .task-meta {
      display: flex;
      gap: 25px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .chat-page .meta-item {
      display: flex;
      align-items: center;
      font-size: 16px;
      color: var(--light-text);
    }
    
    .chat-page .task-price {
      color: var(--success-color);
      font-weight: bold;
    }
    
    .chat-page .task-deadline {
      color: var(--danger-color);
    }
    
    .chat-page .task-level {
      background-color: var(--warning-color);
      color: white;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .chat-page .bi {
      margin-right: 8px;
      font-size: 18px;
    }
    
    .chat-page .task-details {
      padding: 0 25px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out;
    }
    
    .chat-page .task-details.expanded {
      padding: 25px;
      max-height: none;
      overflow: visible;
    }
    
    .chat-page .section {
      margin-bottom: 25px;
    }
    
    .chat-page .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #eee;
      display: flex;
      align-items: center;
    }
    
    .chat-page .section-title i {
      margin-right: 10px;
      color: var(--primary-color);
    }
    
    .chat-page .role-card {
      background: var(--light-bg);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary-color);
    }
    
    .chat-page .role-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .chat-page .role-title {
      font-weight: 700;
      color: var(--primary-color);
      font-size: 18px;
      margin: 0;
    }
    
    .chat-page .skills-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 15px 0;
    }
    
    .chat-page .skill-tag {
      background-color: #e0e0e0;
      color: var(--dark-text);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .chat-page .skill-tag.frontend {
      background-color: #ffe0b2;
      color: #e65100;
    }
    
    .chat-page .skill-tag.backend {
      background-color: #d1c4e9;
      color: #4527a0;
    }
    
    .chat-page .skill-tag.ml {
      background-color: #c8e6c9;
      color: #2e7d32;
    }
    
    .chat-page .skill-tag.data {
      background-color: #bbdefb;
      color: #1565c0;
    }
    
    .chat-page .subtasks {
      padding-left: 20px;
    }
    
    .chat-page .subtasks li {
      margin-bottom: 10px;
      position: relative;
      padding-left: 25px;
    }
    
    .chat-page .upload-section {
      background: #e8f4fd;
      padding: 25px;
      border-radius: 8px;
      margin-top: 30px;
      text-align: center;
      border: 2px dashed #b3d7ff;
    }
    
    .chat-page .upload-btn {
      background-color: var(--primary-color);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      margin-top: 15px;
      transition: background-color 0.3s;
      display: inline-flex;
      align-items: center;
    }
    
    .chat-page .upload-btn:hover {
      background-color: #2980b9;
    }
    
    .chat-page .upload-btn i {
      margin-right: 8px;
    }
    
    .chat-page .chevron {
      transition: transform 0.3s;
      color: var(--light-text);
    }
    
    .chat-page .rotated {
      transform: rotate(180deg);
    }
    
    .chat-page .project-description {
      line-height: 1.8;
      font-size: 16px;
    }
    
    /* Chat container specific styles */
    .chat-page .chat-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 30px;
    }
    .spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .list-group-item {
      transition: all 0.3s ease;
    }
    .list-group-item:hover {
      background-color: #f8f9fa;
    }

    .badge {
      font-size: 0.85em;
      padding: 0.35em 0.65em;
    }
    
    .submission-status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      background-color: #f8f9fa;
      border-left: 4px solid #6c757d;
    }
    
    .submission-status.pending {
      border-left-color: #ffc107;
      background-color: #fff8e1;
    }
    
    .submission-status.approved {
      border-left-color: #28a745;
      background-color: #e8f5e9;
    }
    
    .submission-status.rejected {
      border-left-color: #dc3545;
      background-color: #ffebee;
    }
  </style>
</head>

<body class="bg-gray-100">

  <!-- Header -->
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="/home" class="logo d-flex align-items-center me-auto">
        <img src="{% static 'assets/img/logo.png' %}" alt="">
        <h1 class="sitename">liGo</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="/home" class="active">Home<br></a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/courses">Courses</a></li>
          <li><a href="/my_learning">My Learning</a></li>
          <li><a href="/referrals">Referrals</a></li>
          <li><a href="/chatwithus">Chat with us</a></li>
          <li><a href="/contact">Contact</a></li>
          <li class="dropdown"><a href="/profile"><span>Profile</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="/login">Login</a></li>
              <li><a href="/signup">SignUp</a></li>
            </ul>
          </li>
        </ul>
      </nav>

      <a class="btn-getstarted" href="/my_learning">Get Started</a>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>

    </div>
  </header>

  <main class="container chat-page">
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Assignments</h1>
              <p class="mb-0">Complete Real-World Tasks and Get Paid</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="/home">Home</a></li>
            <li><a href="/my_learning">My Learning</a></li>
            <li class="current">Assignments</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->
    
    <div class="chat-container">
      <div class="task-card">
        <div class="task-header" onclick="toggleTaskDetails()">
          <div>
            <h2 class="task-title">AI Sentiment Analysis Tool Development</h2>
            <div class="task-meta">
              <span class="meta-item task-price">
                <i class="bi bi-currency-rupee"></i>4,500 INR
              </span>
              <span class="meta-item task-deadline">
                <i class="bi bi-clock"></i>7 days delivery
              </span>
              <span class="meta-item">
                <i class="bi bi-bar-chart"></i>
                <span class="task-level">Medium Level</span>
              </span>
            </div>
          </div>
          <i class="bi bi-chevron-down chevron"></i>
        </div>
        
        <div class="task-details expanded" id="taskDetails">
          <div class="section">
            <h3 class="section-title"><i class="bi bi-card-text"></i>Project Description</h3>
            <p class="project-description">
              Develop an AI-powered sentiment analysis tool that can classify text inputs (reviews, comments) into positive, negative, or neutral sentiments. 
              The tool should have a user-friendly interface, a robust backend, and a trained machine learning model with at least 85% accuracy. 
              The project requires collaboration between frontend, backend, and machine learning specialists to deliver a complete working application.
            </p>
          </div>
          
          <div class="section">
            <h3 class="section-title"><i class="bi bi-people"></i>Team Roles & Responsibilities</h3>
            
            <div class="role-card">
              <div class="role-header">
                <h4 class="role-title">Frontend Developer</h4>
              </div>
              <div class="skills-container">
                <span class="skill-tag frontend">HTML5</span>
                <span class="skill-tag frontend">CSS3</span>
                <span class="skill-tag frontend">JavaScript</span>
                <span class="skill-tag frontend">React.js</span>
                <span class="skill-tag frontend">Bootstrap</span>
                <span class="skill-tag frontend">Chart.js</span>
              </div>
              <ul class="subtasks">
                <li>Design and implement a responsive user interface using React.js (optional - can use vanilla JS)</li>
                <li>Create intuitive forms for text input with proper validation</li>
                <li>Display analysis results in an user-friendly manner with visualizations (using Chart.js or similar)</li>
                <li>Ensure mobile responsiveness (at least 3 breakpoints) and cross-browser compatibility</li>
                <li>Implement loading states and error handling for API calls</li>
              </ul>
            </div>
            
            <div class="role-card">
              <div class="role-header">
                <h4 class="role-title">Backend & Integration Developer</h4>
              </div>
              <div class="skills-container">
                <span class="skill-tag backend">Node.js</span>
                <span class="skill-tag backend">Express</span>
                <span class="skill-tag backend">REST API</span>
                <span class="skill-tag backend">MongoDB</span>
                <span class="skill-tag backend">Python</span>
                <span class="skill-tag backend">Flask/Django (optional)</span>
              </div>
              <ul class="subtasks">
                <li>Set up Node.js/Express server with proper project structure</li>
                <li>Create secure REST API endpoints for frontend communication</li>
                <li>Integrate the machine learning model with the backend (can use Python Flask if needed)</li>
                <li>Implement JWT authentication for API endpoints</li>
                <li>Set up MongoDB database for storing analysis history with proper schema design</li>
                <li>Implement rate limiting and request validation</li>
              </ul>
            </div>
            
            <div class="role-card">
              <div class="role-header">
                <h4 class="role-title">Machine Learning Engineer</h4>
              </div>
              <div class="skills-container">
                <span class="skill-tag ml">Python</span>
                <span class="skill-tag ml">TensorFlow/PyTorch</span>
                <span class="skill-tag ml">NLTK</span>
                <span class="skill-tag ml">Scikit-learn</span>
                <span class="skill-tag ml">Transformers</span>
                <span class="skill-tag ml">BERT/LSTM</span>
              </div>
              <ul class="subtasks">
                <li>Select and implement appropriate ML algorithm (BERT, LSTM, or similar)</li>
                <li>Train and fine-tune model on sentiment analysis dataset</li>
                <li>Achieve at least 85% accuracy on test data with proper metrics</li>
                <li>Optimize model for production deployment (size, speed considerations)</li>
                <li>Implement model versioning and create evaluation report</li>
                <li>Create API endpoint for model predictions</li>
              </ul>
            </div>
            
            <div class="role-card">
              <div class="role-header">
                <h4 class="role-title">Data Handler</h4>
              </div>
              <div class="skills-container">
                <span class="skill-tag data">Python</span>
                <span class="skill-tag data">Pandas</span>
                <span class="skill-tag data">Numpy</span>
                <span class="skill-tag data">Data Cleaning</span>
                <span class="skill-tag data">EDA</span>
              </div>
              <ul class="subtasks">
                <li>Source and acquire appropriate datasets (IMDB reviews, Twitter data, etc.)</li>
                <li>Perform comprehensive data cleaning and preprocessing</li>
                <li>Conduct exploratory data analysis (EDA) with visualizations</li>
                <li>Create balanced train/test/validation splits</li>
                <li>Implement data augmentation techniques if needed</li>
                <li>Prepare data documentation and statistics</li>
              </ul>
            </div>
            
            <div class="role-card">
              <div class="role-header">
                <h4 class="role-title">Team Lead</h4>
              </div>
              <div class="skills-container">
                <span class="skill-tag">Project Management</span>
                <span class="skill-tag">Communication</span>
                <span class="skill-tag">Documentation</span>
                <span class="skill-tag">QA Testing</span>
              </div>
              <ul class="subtasks">
                <li>Coordinate between all team members and set up workflows</li>
                <li>Ensure project milestones are met with daily standups</li>
                <li>Handle all client communication and requirement clarification</li>
                <li>Conduct quality assurance testing across all components</li>
                <li>Prepare and submit comprehensive project documentation</li>
                <li>Manage deployment and final delivery process</li>
              </ul>
            </div>
          </div>
          
          <div class="section">
            <h3 class="section-title"><i class="bi bi-list-check"></i>Project Requirements</h3>
            <ul class="subtasks">
              <li>Complete working web application with all features deployed on a live server</li>
              <li>Well-documented source code with README and API documentation</li>
              <li>Trained ML model files with evaluation metrics (precision, recall, F1-score)</li>
              <li>Detailed deployment instructions for both development and production</li>
              <li>User manual with screenshots and feature explanations</li>
              <li>Technical documentation covering architecture decisions</li>
            </ul>
          </div>
          
          <div class="section">
            <h3 class="section-title"><i class="bi bi-clipboard2-check"></i>Evaluation Criteria</h3>
            <ul class="subtasks">
              <li>Model accuracy (minimum 85% on test set) - 30% weight</li>
              <li>UI/UX quality and responsiveness - 20% weight</li>
              <li>System performance and API response time - 15% weight</li>
              <li>Code quality, structure, and documentation - 20% weight</li>
              <li>Completion within deadline - 15% weight</li>
            </ul>
          </div>
          
          <div class="upload-section">
            <h3 class="section-title"><i class="bi bi-file-earmark-arrow-up"></i>Project Documentation Submission</h3>
            <p>Team lead should upload the complete project documentation here after completion. Include all source code, model files, and documentation in a zip file.</p>
            
            <form method="post" enctype="multipart/form-data" id="documentationForm" action="{% url 'assignment_view' %}">
              {% csrf_token %}
              <input type="file" id="documentation" name="documentation" style="display: none;" required>
              <button type="button" class="upload-btn" onclick="document.getElementById('documentation').click()">
                <i class="bi bi-cloud-upload"></i> Select File
              </button>
              <span id="fileName" style="margin-left: 10px;"></span>
              <button type="submit" class="upload-btn" style="background-color: #27ae60; margin-left: 10px;" id="submitBtn">
                <i class="bi bi-check-circle"></i> Submit
              </button>
              <p class="meta-item" style="margin-top: 10px;">
                <i class="bi bi-info-circle"></i> Max file size: 50MB (All file types allowed)
              </p>
              <div id="uploadStatus" style="margin-top: 15px;"></div>
            </form>

            {% if submissions %}
            <div class="mt-4">
              <h4>Your Submissions</h4>
              <div class="list-group">
                {% for submission in submissions %}
                <div class="list-group-item">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <strong>Submitted:</strong> {{ submission.submitted_at|date:"F j, Y H:i" }}
                      <br>
                      <strong>Status:</strong> 
                      <span class="badge 
                        {% if submission.status == 'approved' %}bg-success
                        {% elif submission.status == 'rejected' %}bg-danger
                        {% else %}bg-primary{% endif %}">
                        {{ submission.get_status_display }}
                      </span>
                      {% if submission.feedback %}
                        <div class="mt-2">
                          <strong>Feedback:</strong> {{ submission.feedback }}
                        </div>
                      {% endif %}
                    </div>
                    <a href="{{ submission.documentation.url }}" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-download"></i> Download
                    </a>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}
            
            <div id="submissionStatus" class="submission-status {% if submissions %}mt-3{% endif %}">
              {% if submissions %}
                {% with latest_submission=submissions.last %}
                  <h5>Current Status</h5>
                  <div class="d-flex align-items-center">
                    <strong>Status:</strong> 
                    <span class="badge ms-2 
                      {% if latest_submission.status == 'approved' %}bg-success
                      {% elif latest_submission.status == 'rejected' %}bg-danger
                      {% else %}bg-warning text-dark{% endif %}">
                      {{ latest_submission.get_status_display }}
                    </span>
                  </div>
                  {% if latest_submission.feedback %}
                    <div class="mt-2">
                      <strong>Feedback:</strong> {{ latest_submission.feedback }}
                    </div>
                  {% endif %}
                {% endwith %}
              {% else %}
                <p>No submissions yet. Please upload your project documentation.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer id="footer" class="footer position-relative light-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="/home" class="logo d-flex align-items-center">
            <span class="sitename">EliGo</span>
          </a>
          <div class="footer-contact pt-3">
            <p>Noval Tech, HSR Layout</p>
            <p>Bengaluru, Pin - 560102</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+91 98765 43210</span></p>
            <p><strong>Email:</strong> <span>info@ligo.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="/home">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/courses">Courses</a></li>
            <li><a href="/contact">Contact</a></li>
            <li><a href="/sponsorship">Sponsorship</a></li>
            <li><a href="/privacypolicy">Privacy policy</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><a href="/courses">Web Development</a></li>
            <li><a href="/courses">Data Science</a></li>
            <li><a href="/courses">Digital Marketing</a></li>
            <li><a href="/courses">UI/UX Design</a></li>
            <li><a href="/courses">Cloud Computing</a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-12 footer-newsletter">
          <h4>Our Newsletter</h4>
          <p>Subscribe to our newsletter and receive the latest updates about our courses and events!</p>
          <form action="forms/newsletter.php" method="post" class="php-email-form">
            <div class="newsletter-form"><input type="email" name="email"><input type="submit" value="Subscribe"></div>
            <div class="loading">Loading</div>
            <div class="error-message"></div>
            <div class="sent-message">Your subscription request has been sent. Thank you!</div>
          </form>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">EliGo</strong> <span>All Rights Reserved</span></p>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
  <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
  <script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
  <script src="{% static 'assets/vendor/purecounter/purecounter_vanilla.js' %}"></script>
  <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>

  <!-- Main JS File -->
  <script src="{% static 'assets/js/main.js' %}"></script>
  <script>
    // Toggle task details function
    function toggleTaskDetails() {
      const details = document.getElementById('taskDetails');
      const chevron = document.querySelector('.chevron');
      
      details.classList.toggle('expanded');
      chevron.classList.toggle('rotated');

      if(details.classList.contains('expanded')) {
        details.style.maxHeight = 'none';
      } else {
        details.style.maxHeight = '0';
      }
    }

    // Main DOM ready handler
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('documentationForm');
        const fileInput = document.getElementById('documentation');
        const fileNameSpan = document.getElementById('fileName');
        const submitBtn = document.getElementById('submitBtn');
        const uploadStatus = document.getElementById('uploadStatus');
        const submissionStatus = document.getElementById('submissionStatus');

        if (fileInput && fileNameSpan) {
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    fileNameSpan.textContent = this.files[0].name;
                    fileNameSpan.style.color = '#333';
                    clearStatus(uploadStatus);
                } else {
                    fileNameSpan.textContent = 'No file selected';
                    fileNameSpan.style.color = '#777';
                }
            });
        }

        if (form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                if (!validateForm(fileInput, uploadStatus)) {
                    return;
                }

                setLoadingState(true, submitBtn, uploadStatus);

                try {
                    const response = await submitForm(form);
                    if (response.success) {
                        showSuccess(uploadStatus, response.message);
                        updateSubmissionStatus(response.submission);
                        setTimeout(() => {
                            toggleTaskDetails(); // Collapse the task details
                            window.location.reload(); // Refresh to show new submission
                        }, 1500);
                    } else {
                        throw new Error(response.error || 'Upload failed');
                    }
                } catch (error) {
                    handleSubmissionError(error, uploadStatus);
                } finally {
                    setLoadingState(false, submitBtn, uploadStatus);
                }
            });
        }

        function validateForm(fileInput, statusElement) {
            if (!fileInput.files.length) {
                showError(statusElement, 'Please select a file first');
                return false;
            }

            if (fileInput.files[0].size > 50 * 1024 * 1024) {
                showError(statusElement, 'File must be less than 50MB');
                return false;
            }

            return true;
        }

        async function submitForm(form) {
            const formData = new FormData(form);
            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value,
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Error submitting form:', error);
                throw error;
            }
        }

        function setLoadingState(isLoading, button, statusElement) {
            button.disabled = isLoading;
            button.innerHTML = isLoading 
                ? '<i class="bi bi-arrow-repeat spin"></i> Uploading...' 
                : '<i class="bi bi-check-circle"></i> Submit';
            
            if (isLoading) {
                statusElement.innerHTML = '<div class="alert alert-info">Uploading file...</div>';
            }
        }

        function showError(element, message) {
            element.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        function showSuccess(element, message) {
            element.innerHTML = `<div class="alert alert-success">${message}</div>`;
        }

        function clearStatus(element) {
            element.innerHTML = '';
        }

        function updateSubmissionStatus(submission) {
            if (!submissionStatus) return;
            
            let statusClass = 'pending';
            let statusText = 'Pending Review';
            
            if (submission.status === 'approved') {
                statusClass = 'approved';
                statusText = 'Approved';
            } else if (submission.status === 'rejected') {
                statusClass = 'rejected';
                statusText = 'Rejected';
            }
            
            submissionStatus.className = `submission-status ${statusClass} mt-3`;
            submissionStatus.innerHTML = `
                <h5>Current Status</h5>
                <div class="d-flex align-items-center">
                    <strong>Status:</strong> 
                    <span class="badge ms-2 
                        ${submission.status === 'approved' ? 'bg-success' : 
                          submission.status === 'rejected' ? 'bg-danger' : 'bg-warning text-dark'}">
                        ${statusText}
                    </span>
                </div>
                ${submission.feedback ? `
                <div class="mt-2">
                    <strong>Feedback:</strong> ${submission.feedback}
                </div>` : ''}
            `;
        }

        function handleSubmissionError(error, statusElement) {
            console.error('Submission error:', error);
            let userMessage = 'An error occurred during submission';
            if (error.message.includes('CSRF')) {
                userMessage = 'Session expired. Please refresh the page.';
            } else if (error.message.includes('Expected JSON')) {
                userMessage = 'Server responded with unexpected format';
            } else if (error.message.includes('401')) {
                userMessage = 'Please login to submit files';
            } else if (error.message.includes('413')) {
                userMessage = 'File size exceeds limit';
            } else if (error.message.includes('400')) {
                userMessage = 'Invalid file type';
            }
            showError(statusElement, userMessage);
        }
    });

    // Add spin animation style
    const spinStyle = document.createElement('style');
    spinStyle.textContent = `
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spin { animation: spin 1s linear infinite; display: inline-block; }
    `;
    document.head.appendChild(spinStyle);
  </script>
</body>
</html>